const { DB, singleDB } = require("./db.model");

// CREATE

const saveBooking = async (bookingData) => {
    try {
        const query = `INSERT INTO booking SET ?`;
        const response = await DB(query, bookingData);
        const status = Number(response.affectedRows && response.affectedRows === 1);
        return { status, requestID: Number(response.insertId) };
    } catch (error) {
        return { status: 0, error };
    }
};

const requestUserByZipCode = async (zipCode) => {
    try {
        const query = `SELECT * FROM calendars WHERE zipCodes LIKE '%?%'`;
        return { ...(await singleDB(query, [ Number(zipCode) ])) };
    } catch (error) {
        return { status: 0, error };
    }
};

const tempRedirect = async (zipCode) => {
    const codes = {
        'https://basementmasters.youcanbook.me': `20707, 20777, 20812, 20814, 20815, 20816, 20817, 20818, 20832, 20833, 20837, 20838, 20839, 20841, 20842, 20850, 20851, 20852, 20853, 20854, 20855, 20860, 20861, 20862, 20866, 20880, 20812, 20886, 20899, 20868, 20871, 20872, 20874, 20876, 20877, 20878, 20879, 20882, 20886, 20889, 20892, 20894, 20895, 20899, 20901, 20902, 20903, 20904, 20905, 20906, 20910, 20912, 21771, 20810, 20811, 20813, 20896, 20810, 20812, 20814, 20058, 20880, 20875, 20866, 20859, 20906, 20811, 20882, 20879, 20877, 20876, 20857, 20710, 20712, 20722, 20737, 20731, 20743, 20746, 20747, 20748, 20762, 20781, 20782, 20783, 20784, 20785, 20607, 20608, 20710, 20613, 20743, 20737, 20747, 20769, 20781, 20785, 20784, 20623, 20746, 20703, 20704, 20705, 20706, 20707, 20708, 20709, 20715, 20716, 20717, 20718, 20719, 20720, 20721, 20725, 20726, 20735, 20740, 20742, 20768, 20769, 20770, 20771, 20772, 20774, 20744, 20745, 20790, 20791, 20603, 20799, 20842, 20871, 21701, 21702, 21703, 21704, 21710, 21717, 21754, 21755, 21758, 21769, 21770, 21771, 21774, 21776, 21777, 21790, 21791, 21792, 21793, 21757, 21759, 21762, 21778, 21798, 21709, 20701, 20723, 20759, 20763, 20777, 20794, 20833, 21029, 21036, 21042, 21043,  21044, 21045, 21046, 21075, 21076, 21104, 21163, 21723, 21737, 21738, 21771, 21784, 21794, 21797, 20777, 20701,20711, 20724, 20733, 20751, 20754, 20755, 20758, 20764, 20776, 20778, 20779, 20794, 21032, 21035, 21037, 21054, 21076, 21077, 21113, 21114, 21144, 21401, 21403, 20751, 20765, 21012, 21056, 21060, 21012, 21060, 21061, 21090, 21108, 21122, 21122, 21122, 21123, 21123, 21123, 21146, 21225, 21226, 21409, 21061, 21060, 21113, 21122, 21123, 21140, 21146, 21402, 21405`,
        'https://basementmasters-baltimore.youcanbook.me': `21048, 21074, 21102, 21157, 21052, 21222, 21236, 21234, 21104, 21084, 21757, 21776, 21787, 21791, 21158, 21206, 21212, 21237, 21023, 21239, 21282, 21286, 21052, 21057, 21071, 21074, 21082, 21087, 21092, 21093, 21102, 21105, 21104, 21013, 21030, 21031, 21051, 21053, 21057, 21082, 21087, 21093, 21111, 21117, 21120, 21128, 21131, 21133, 21136, 21152, 21155, 21161, 21162, 21204, 21208, 21209, 21219, 21220, 21221, 21224, 21228, 21244, 21207, 21009, 21013, 21014, 21015, 21018, 21040, 21047, 21050, 21082, 21085, 21087, 21111, 21078, 21085, 21005, 21018, 21130, 21017, 21132, 21160`,
        'https://basementmasters-dc.youcanbook.me': `20001, 20002, 20003, 20004, 20005, 20006, 20007, 20008, 20009, 20010, 20011, 20012, 20013, 20015, 20016, 20017, 20018, 20019, 20020, 20024, 20026, 20029, 20030, 20032, 20033, 20035, 20036, 20037, 20038, 20039, 20040, 20041, 20042, 20043, 20044, 20045, 20046, 20047, 20049, 20050, 20051, 20052, 20053, 20055, 20056, 20057, 20058, 20059, 20060, 20061, 20062, 20063, 20064, 20065, 20066, 20067, 20068, 20069, 20070, 20071, 20073, 20074, 20075, 20076, 20077, 20078, 20080, 20081, 20082, 20088, 20090, 20091, 20097, 20098, 20099, 20201, 20202, 20203, 20204, 20206, 20207, 20208, 20210, 20211, 20212, 20213, 20214, 20215, 20216, 20217, 20218, 20219, 20220, 20221, 20222, 20223, 20224, 20226, 20227, 20228, 20229, 20230, 20231, 20232, 20233, 20235, 20238, 20239, 20240, 20241, 20242, 20244, 20245, 20250, 20251, 20254, 20260, 20261, 20262, 20265, 20266, 20268, 20270, 20277, 20289, 20299, 20301, 20303, 20306, 20307, 20310, 20314, 20315, 20317, 20318, 20319, 20330, 20332, 20336, 20337, 20338, 20340, 20350, 20370, 20372, 20373, 20374, 20375, 20380, 20388, 20389, 20390, 20391, 20392, 20393, 20394, 20395, 20398, 20401, 20402, 20403, 20404, 20405, 20406, 20407, 20408, 20409, 20410, 20411, 20412, 20413, 20414, 20415, 20416, 20418, 20419, 20420, 20421, 20422, 20423, 20424, 20425, 20426, 20427, 20428, 20429, 20431, 20433, 20434, 20435, 20436, 20437, 20439, 20440, 20441, 20442, 20444, 20447, 20451, 20453, 20456, 20460, 20463, 20468, 20469, 20470, 20472, 20501, 20502, 20503, 20504, 20505, 20506, 20507, 20508, 20510, 20515, 20520, 20521, 20522, 20523, 20524, 20525, 20526, 20527, 20530, 20531, 20532, 20533, 20534, 20535, 20536, 20537, 20538, 20539, 20540, 20541, 20542, 20543, 20544, 20546, 20547, 20548, 20549, 20550, 20551, 20552, 20553, 20554, 20555, 20557, 20558, 20559, 20560, 20565, 20566, 20570, 20571, 20572, 20573, 20575, 20576, 20577, 20578, 20579, 20580, 20581, 20585, 20586, 20590, 20591, 20593, 20594, 20597, 20599, 20018, 20002, 20003, 20032, 20020, 20019`,
        'https://basementmasters-va2.youcanbook.me': `20142, 20166, 20105, 20148, 20147, 20164, 20165, 20175, 20117, 20132, 20135, 20184, 20158, 20197, 20180, 20176, 20186, 22712, 20137, 20138, 20139, 20119, 20144, 22720, 22639, 22643, 20115, 20116, 22728, 22712, 20187, 20186, 20128, 20140, 22734, 22739, 22742, 20198, 20184, 20185, 20188, 20137, 20169, 20143, 20155, 20109, 20136, 20110, 20111, 20181, 20119, 20112, 22193, 22192, 22191, 22025, 22026, 22134, 22172, 22446, 22554, 22406, 22405, 22135, 22403, 22556`,
        'https://basementmasters-va.youcanbook.me': `22201, 22202, 22203, 22204, 22205, 22206, 22207, 22209, 22211, 22213, 22214, 22215, 22216, 22217, 22219, 22225, 22227, 22230, 22240, 22241, 22242, 22244, 22245, 22246, 22301, 22302, 22304, 22305, 22311, 22314, 22312, 22206, 20120, 20121, 20124, 20151, 20152, 22003, 22015, 22027, 22030, 22031, 22032, 22035, 22039, 22041, 22042, 22303, 22306, 22307, 22308, 22309, 22310, 22312, 22315, 22046, 20170, 20171, 20190, 20191, 20194, 22043, 22044, 22066, 22101, 22102, 22124, 22150, 22151, 22152, 22153, 22180, 22181, 22182, 22185, 22079, 20122, 20170, 22190`
    };
    const links = Object.keys(codes);
    let state;
    links.forEach((link, index) => {
        const currentLink = codes[link].split(`, `).find((code) => code === zipCode);
        if (currentLink) state = index;
    });
    const status = links[state] !== undefined ? 1 : 0;
    return { status, link: links[state] };
};

module.exports = { saveBooking, requestUserByZipCode, tempRedirect };